#!Dockerfile
# Auteur:   Alain Boudreault
# Date:     2026.02.05
# Solution: Laboratoire 5.8.1 de Dockerfile-Introduction
# -----------------------------------------------------------------------------------
# $ docker build -f .\Dockerfile-labo-5.8.1 -t labo:5.8.1 --build-arg PORT=888 .
# -----------------------------------------------------------------------------------

# Utiliser l'image officielle Apache httpd
FROM httpd:2.4-alpine

# D√©finir l'argument de build pour le port (valeur par d√©faut : 80)
ARG PORT=80

LABEL org.label-schema.docker.build.cmd="docker build -f labo5.8.1 -t labo:5.8 --build-arg PORT=888 ."

# Cr√©er le fichier index.html personnalis√©, avec l'aide de Claude.ai ;-)
RUN echo '<!DOCTYPE html>' > /usr/local/apache2/htdocs/index.html && \
    echo '<html lang="fr">' >> /usr/local/apache2/htdocs/index.html && \
    echo '<head>' >> /usr/local/apache2/htdocs/index.html && \
    echo '    <meta charset="UTF-8">' >> /usr/local/apache2/htdocs/index.html && \
    echo '    <meta name="viewport" content="width=device-width, initial-scale=1.0">' >> /usr/local/apache2/htdocs/index.html && \
    echo '    <title>Mon Site Web</title>' >> /usr/local/apache2/htdocs/index.html && \
    echo '    <style>' >> /usr/local/apache2/htdocs/index.html && \
    echo '        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }' >> /usr/local/apache2/htdocs/index.html && \
    echo '        .container { max-width: 800px; margin: 100px auto; padding: 40px; background: white; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }' >> /usr/local/apache2/htdocs/index.html && \
    echo '        h1 { color: #333; text-align: center; }' >> /usr/local/apache2/htdocs/index.html && \
    echo '        p { color: #666; line-height: 1.6; text-align: center; }' >> /usr/local/apache2/htdocs/index.html && \
    echo '        .info { background: #f0f0f0; padding: 20px; border-radius: 5px; margin-top: 20px; }' >> /usr/local/apache2/htdocs/index.html && \
    echo '    </style>' >> /usr/local/apache2/htdocs/index.html && \
    echo '</head>' >> /usr/local/apache2/htdocs/index.html && \
    echo '<body>' >> /usr/local/apache2/htdocs/index.html && \
    echo '    <div class="container">' >> /usr/local/apache2/htdocs/index.html && \
    echo '        <h1>üöÄ Bienvenue sur mon serveur Apache !</h1>' >> /usr/local/apache2/htdocs/index.html && \
    echo '        <p>Ce site fonctionne dans un conteneur Docker avec httpd.</p>' >> /usr/local/apache2/htdocs/index.html && \
    echo '        <p>Pr√©par√© par Alain Boudreault (c) 2026.</p>' >> /usr/local/apache2/htdocs/index.html && \
    echo "        <div class=\"info\">" >> /usr/local/apache2/htdocs/index.html && \
    echo "            <p><strong>Port expos√© :</strong> ${PORT}</p>" >> /usr/local/apache2/htdocs/index.html && \
    echo "            <p><strong>Serveur :</strong> Apache HTTP Server</p>" >> /usr/local/apache2/htdocs/index.html && \
    echo "        </div>" >> /usr/local/apache2/htdocs/index.html && \
    echo '    </div>' >> /usr/local/apache2/htdocs/index.html && \
    echo '</body>' >> /usr/local/apache2/htdocs/index.html && \
    echo '</html>' >> /usr/local/apache2/htdocs/index.html

# Cr√©er la page 404 personnalis√©e, , avec l'aide de Claude.ai ;-)
RUN echo '<!DOCTYPE html>' > /usr/local/apache2/htdocs/404.html && \
    echo '<html lang="fr">' >> /usr/local/apache2/htdocs/404.html && \
    echo '<head>' >> /usr/local/apache2/htdocs/404.html && \
    echo '    <meta charset="UTF-8">' >> /usr/local/apache2/htdocs/404.html && \
    echo '    <meta name="viewport" content="width=device-width, initial-scale=1.0">' >> /usr/local/apache2/htdocs/404.html && \
    echo '    <title>404 - Page non trouv√©e</title>' >> /usr/local/apache2/htdocs/404.html && \
    echo '    <style>' >> /usr/local/apache2/htdocs/404.html && \
    echo '        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }' >> /usr/local/apache2/htdocs/404.html && \
    echo '        .container { max-width: 800px; margin: 100px auto; padding: 40px; background: white; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; }' >> /usr/local/apache2/htdocs/404.html && \
    echo '        h1 { color: #f5576c; font-size: 72px; margin: 0; }' >> /usr/local/apache2/htdocs/404.html && \
    echo '        h2 { color: #333; margin-top: 20px; }' >> /usr/local/apache2/htdocs/404.html && \
    echo '        p { color: #666; line-height: 1.6; }' >> /usr/local/apache2/htdocs/404.html && \
    echo '        a { display: inline-block; margin-top: 20px; padding: 12px 24px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; transition: background 0.3s; }' >> /usr/local/apache2/htdocs/404.html && \
    echo '        a:hover { background: #764ba2; }' >> /usr/local/apache2/htdocs/404.html && \
    echo '        .emoji { font-size: 80px; margin: 20px 0; }' >> /usr/local/apache2/htdocs/404.html && \
    echo '    </style>' >> /usr/local/apache2/htdocs/404.html && \
    echo '</head>' >> /usr/local/apache2/htdocs/404.html && \
    echo '<body>' >> /usr/local/apache2/htdocs/404.html && \
    echo '    <div class="container">' >> /usr/local/apache2/htdocs/404.html && \
    echo '        <img src="/404.jpg" alt="404" style="max-width: 600px; margin: 20px 0;" />' >> /usr/local/apache2/htdocs/404.html && \
    echo '        <h2>Oups ! Page non trouv√©e</h2>' >> /usr/local/apache2/htdocs/404.html && \
    echo '        <p>La page que vous recherchez n'"'"'existe pas ou a √©t√© d√©plac√©e.</p>' >> /usr/local/apache2/htdocs/404.html && \
    echo '        <a href="/">Retour √† l'"'"'accueil</a>' >> /usr/local/apache2/htdocs/404.html && \
    echo '    </div>' >> /usr/local/apache2/htdocs/404.html && \
    echo '</body>' >> /usr/local/apache2/htdocs/404.html && \
    echo '</html>' >> /usr/local/apache2/htdocs/404.html

# Configurer Apache pour utiliser la page 404 personnalis√©e
RUN echo 'ErrorDocument 404 /404.html' >> /usr/local/apache2/conf/httpd.conf

COPY 404.jpg /usr/local/apache2/htdocs/404.jpg

# Configuration du port:
RUN sed -i "s/Listen 80/Listen ${PORT}/g" /usr/local/apache2/conf/httpd.conf

# Exposer le port d√©fini par la variable d'environnement
EXPOSE ${PORT}

# D√©marrer Apache en mode foreground
CMD ["httpd-foreground"]


#<Directory /var/www/>
#        Options Indexes FollowSymLinks
#        AllowOverride None
#        Require all granted
#</Directory>